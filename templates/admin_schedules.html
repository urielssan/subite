{% extends "base.html" %}
{% block content %}
<h1>Horarios</h1>

<div class="card card-10">
  <form method="post">
    <label>Ruta</label>
    <select name="route"><option value="RC-CBA">Río Cuarto → Córdoba</option><option value="CBA-RC">Córdoba → Río Cuarto</option></select>
    <label>Fecha</label><input type="date" name="date" required>
    <label>Hora</label><input type="time" name="time" required>
    <label>Cupo</label><input type="number" name="capacity" value="4" min="1" max="8">
    <button type="submit">Agregar / Actualizar</button>
  </form>
</div>

<!-- Mostrar por día y por ruta dentro del día -->
{% for day in grouped_schedules %}
  <div class="card card-50">
    <h2>{{ day.date.strftime('%A, %d %b %Y') }}</h2>

    {% for route_group in day.routes %}
      <h3 style="margin-top:10px;">{{ 'RC→CBA' if route_group.route == 'RC-CBA' else 'CBA→RC' }}</h3>
      <table class="table" style="margin-bottom:12px;">
        <thead>
          <tr>
            <th>Hora</th><th>Cupo</th><th>Reservados</th><th>Acción</th>
          </tr>
        </thead>
        <tbody>
          {% for s in route_group.schedules %}
          <tr>
            <td>{{ s.time }}</td>
            <td>{{ s.capacity }}</td>
            <td>{{ booked_seats(s.id) }}</td>
            <td>
              <form method="post" action="{{ url_for('admin_delete_schedule') }}" onsubmit="return confirm('¿Eliminar este horario?');" style="display:inline;">
                <input type="hidden" name="id" value="{{ s.id }}">
                <button type="submit" class="btn delete">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}

  </div>
{% else %}
  <div class="card">
    <p>No hay horarios próximos.</p>
  </div>
{% endfor %}

{% endblock %}
