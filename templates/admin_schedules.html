{% extends "base.html" %}
{% block content %}
<h1>Horarios</h1>

<div class="card card-10">
  <h3>Agregar / Actualizar horario (por día)</h3>
  <form method="post" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
    <label style="width:140px;">Ruta</label>
    <select name="route" required>
      <option value="RC-CBA">Río Cuarto → Córdoba</option>
      <option value="CBA-RC">Córdoba → Río Cuarto</option>
    </select>

    <label style="width:140px;">Fecha</label>
    <input type="date" name="date" required>

    <label style="width:140px;">Hora</label>
    <input type="time" name="time" required style="width:160px;">

    <label style="width:140px;">Cupo</label>
    <input type="number" name="capacity" min="1" max="20" value="4" style="width:100px;">

    <div style="width:100%;margin-top:6px;">
      <button type="submit" class="btn">Guardar para la fecha</button>
      <small style="display:block;margin-top:6px;color:var(--muted);">Esto añade o actualiza el horario solo para la fecha seleccionada.</small>
    </div>
  </form>
</div>

<!-- Mantener solo el formulario de eliminación individual en la tabla (eliminar por fila) -->
<!-- Mostrar por día y por ruta dentro del día -->
{% for day in grouped_schedules %}
  <div class="card card-50">
    <h2>{{ day.date.strftime('%A, %d %b %Y') }}</h2>

    {% for route_group in day.routes %}
      <h3 style="margin-top:10px;">{{ 'RC→CBA' if route_group.route == 'RC-CBA' else 'CBA→RC' }}</h3>
      <table class="table" style="margin-bottom:12px;">
        <thead>
          <tr>
            <th>Hora</th><th>Cupo</th><th>Reservados</th><th>Acción</th>
          </tr>
        </thead>
        <tbody>
          {% for s in route_group.schedules %}
          <tr>
            <td>{{ s.time }}</td>
            <td>{{ s.capacity }}</td>
            <td>{{ booked_seats(s.id) }}</td>
            <td>
              <form method="post" action="{{ url_for('admin_delete_schedule') }}" onsubmit="return confirm('¿Eliminar este horario?');" style="display:inline;">
                <input type="hidden" name="id" value="{{ s.id }}">
                <button type="submit" class="btn delete">Eliminar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}

  </div>
{% else %}
  <div class="card">
    <p>No hay horarios próximos.</p>
  </div>
{% endfor %}

{% endblock %}
