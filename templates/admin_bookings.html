{% extends "base.html" %}
{% block content %}
<h1>Reservas</h1>

<!-- Filtros mejorados -->
<div class="card">
  <div class="filters-container">
    <form method="get" class="filters-form">
      <div class="filter-group">
        <label for="filter">Período:</label>
        <select name="filter" id="filter" onchange="this.form.submit()">
          <option value="day" {{ 'selected' if current_date_filter == 'day' }}>Hoy</option>
          <option value="week" {{ 'selected' if current_date_filter == 'week' }}>Esta semana</option>
          <option value="all" {{ 'selected' if current_date_filter == 'all' }}>Histórico</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="route">Ruta:</label>
        <select name="route" id="route" onchange="this.form.submit()">
          <option value="all" {{ 'selected' if current_route_filter == 'all' }}>Ambas rutas</option>
          <option value="RC-CBA" {{ 'selected' if current_route_filter == 'RC-CBA' }}>RC → CBA</option>
          <option value="CBA-RC" {{ 'selected' if current_route_filter == 'CBA-RC' }}>CBA → RC</option>
        </select>
      </div>

    </form>
  </div>
</div>

<div class="card">
  <h2>Viajes Compartidos</h2>
  <table class="table">
    <thead><tr><th>Fecha</th><th>Hora</th><th>Ruta</th><th>Pasajeros</th><th>Nombre</th><th>Tel</th><th>Retiro</th><th>Llegada</th><th>Total</th><th>Acción</th></tr></thead>
    <tbody>
      {% for b in shared %}
      <tr>
        <td>{{ b.schedule.date }}</td>
        <td>{{ b.schedule.time }}</td>
        <td>{{ b.schedule.route }}</td>
        <td>{{ b.passengers }}</td>
        <td>{{ b.name }}</td>
        <td>{{ b.phone }}</td>
        <td>{{ b.pickup_address if b.pickup_address else '—' }}</td>
        <td>{{ b.final_address if b.final_address else '—' }}</td>
        <td>${{ '%.0f'|format(b.total_price) }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_booking') }}" onsubmit="return confirm('Eliminar reserva?');" style="display:inline;">
            <input type="hidden" name="type" value="shared">
            <input type="hidden" name="id" value="{{ b.id }}">
            <button type="submit" class="btn delete">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Resto de las secciones sin cambios -->
<hr>
<div class="card">
  <h2>Encomiendas</h2>
  <table class="table">
    <thead><tr><th>Fecha</th><th>Ruta</th><th>Bultos</th><th>Nombre</th><th>Tel</th><th>Retiro</th><th>Entrega</th><th>Total</th><th>Acción</th></tr></thead>
    <tbody>
      {% for b in parcels %}
      <tr>
        <td>{{ b.date }}</td><td>{{ b.route }}</td><td>{{ b.parcels }}</td><td>{{ b.name }}</td><td>{{ b.phone }}</td><td>{{ b.pickup_address if b.pickup_address else '—' }}</td><td>{{ b.final_address if b.final_address else '—' }}</td><td>${{ '%.0f'|format(b.total_price) }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_booking') }}" onsubmit="return confirm('Eliminar reserva?');" style="display:inline;">
            <input type="hidden" name="type" value="parcels">
            <input type="hidden" name="id" value="{{ b.id }}">
            <button type="submit" class="btn delete">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr>
<div class="card">
  <h2>Aeropuerto</h2>
  <table class="table">
    <thead><tr><th>Fecha</th><th>Hora</th><th>Nombre</th><th>Tel</th><th>Retiro</th><th>Llegada</th><th>Total</th><th>Acción</th></tr></thead>
    <tbody>
      {% for b in airport %}
      <tr>
        <td>{{ b.date }}</td><td>{{ b.time }}</td><td>{{ b.name }}</td><td>{{ b.phone }}</td><td>{{ b.pickup_address if b.pickup_address else '—' }}</td><td>{{ b.final_address if b.final_address else '—' }}</td><td>${{ '%.0f'|format(b.total_price) }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_booking') }}" onsubmit="return confirm('Eliminar reserva?');" style="display:inline;">
            <input type="hidden" name="type" value="airport">
            <input type="hidden" name="id" value="{{ b.id }}">
            <button type="submit" class="btn delete">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr>
<div class="card">
  <h2>Exclusivo RC↔CBA</h2>
  <table class="table">
    <thead><tr><th>Fecha</th><th>Hora</th><th>Ruta</th><th>Nombre</th><th>Tel</th><th>Retiro</th><th>Llegada</th><th>Total</th><th>Acción</th></tr></thead>
    <tbody>
      {% for b in exclusive %}
      <tr>
        <td>{{ b.date }}</td><td>{{ b.time }}</td><td>{{ b.route }}</td><td>{{ b.name }}</td><td>{{ b.phone }}</td><td>{{ b.pickup_address if b.pickup_address else '—' }}</td><td>{{ b.final_address if b.final_address else '—' }}</td><td>${{ '%.0f'|format(b.total_price) }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_booking') }}" onsubmit="return confirm('Eliminar reserva?');" style="display:inline;">
            <input type="hidden" name="type" value="exclusive">
            <input type="hidden" name="id" value="{{ b.id }}">
            <button type="submit" class="btn delete">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<hr>
<div class="card">
  <h2>Cualquier destino</h2>
  <table class="table">
    <thead><tr><th>Fecha</th><th>Hora</th><th>Origen</th><th>Destino</th><th>KM</th><th>Retiro</th><th>Entrega</th><th>Nombre</th><th>Tel</th><th>Total</th><th>Acción</th></tr></thead>
    <tbody>
      {% for b in anywhere %}
      <tr>
        <td>{{ b.date }}</td><td>{{ b.time }}</td><td>{{ b.origin_city }}</td><td>{{ b.destination_city }}</td><td>{{ b.km_estimate }}</td><td>{{ b.origin_street if b.origin_street else '—' }}</td><td>{{ b.destination_street if b.destination_street else '—' }}</td><td>{{ b.name }}</td><td>{{ b.phone }}</td><td>${{ '%.0f'|format(b.total_price) }}</td>
        <td>
          <form method="post" action="{{ url_for('admin_delete_booking') }}" onsubmit="return confirm('Eliminar reserva?');" style="display:inline;">
            <input type="hidden" name="type" value="anywhere">
            <input type="hidden" name="id" value="{{ b.id }}">
            <button type="submit" class="btn delete">Eliminar</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
